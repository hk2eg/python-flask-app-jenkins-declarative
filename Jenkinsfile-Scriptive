pipeline {
    agent 'agent-1'
    stages {
        stage('Build docker image') {
            steps {
                try {
                    sh "docker build -t hk2802/flask-sample:v${BUILD_NUMBER} ."
                }
                catch (exc) {
                    echo 'Stage: "Build docker image" has failed! Check Dockerfile for errors.'
                    throw
                }
            }
        }

        stage('Push docker image') {
            steps {
                try {
                    sh "docker push hk2802/flask-sample:v${BUILD_NUMBER}"
                }
                catch (exc) {
                    echo 'Stage: "Push docker image" has failed! Check Dockerhub credentials and try again.'
                    throw
                }
            }
        }
    }
}